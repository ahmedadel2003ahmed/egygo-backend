# Frontend Web AI Chatbot Integration Guide (React/Vite)

## Overview
This guide details how to integrate the "LocalGuide AI" chatbot into the React web application. The chatbot supports hybrid responses (Database FAQ + Gemini AI) and maintains conversation context.

## 1. API Configuration

### Base URL
Assuming your backend is running locally at `http://localhost:5000`:
- **Endpoint**: `/api/chat`
- **Method**: `POST`
- **Auth**: Not required (Public access), but you can include `Authorization` header if the user is logged in.

### Headers
```json
{
  "Content-Type": "application/json"
}
```

## 2. Request Structure

The backend expects the current message + the conversation history.

### JSON Body
```json
{
  "message": "Can you recommend a hotel in Cairo?",
  "history": [
    {
      "role": "user",
      "content": "Hi"
    },
    {
      "role": "model",
      "content": "Hello! I'm LocalGuide AI. How can I help you?"
    }
  ]
}
```

## 3. Response Structure

### JSON Response
```json
{
  "success": true,
  "source": "gemini", 
  "success": true,
  "source": "gemini", 
  "reply": "I recommend the Old Cataract Hotel...",
  "data": [
    {
      "id": "60d5ec...",
      "name": "Marriott Mena House",
      "type": "hotels",
      "description": "...",
      "images": ["url1", "url2"],
      "rating": 4.8,
      "slug": "marriott-mena-house"
    }
  ]
}
```

| Field | Type | Description |
|-------|------|-------------|
| `success` | Boolean | True if successful. |
| `source` | String | `'database'` (FAQ) or `'gemini'` (AI). |
| `reply` | String | The text response to display. |
| `data` | Array | Optional. List of place objects to render as cards. |

## 4. React Implementation Guide

### A. State Management
You need state for the input, the message list, and a loading flag.

```javascript
const [input, setInput] = useState('');
const [messages, setMessages] = useState([]); // Array of { role: 'user' | 'model', content: string }
const [isLoading, setIsLoading] = useState(false);
```

### B. Sending a Message
Use `axios` or `fetch` to send the data.

```javascript
const sendMessage = async () => {
  if (!input.trim()) return;

  // 1. Add user message to UI immediately
  const userMsg = { role: 'user', content: input };
  const newHistory = [...messages, userMsg];
  setMessages(newHistory);
  setInput('');
  setIsLoading(true);

  try {
    // 2. Call API
    const response = await fetch('http://localhost:5000/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: input,
        history: messages // Send previous history
      })
    });

    const data = await response.json();

    if (data.success) {
      // 3. Add AI response to UI
      setMessages([...newHistory, { 
        role: 'model', 
        content: data.reply,
        data: data.data || [] // Store structure data if available
      }]);
    }
  } catch (error) {
    console.error('Chat error:', error);
    // Handle error (e.g., show toast)
  } finally {
    setIsLoading(false);
  }
};
```

### C. Displaying Messages (Markdown)
The AI response may contain specific formatting (bold, lists). Use `react-markdown` to render it properly.

**Install:**
`npm install react-markdown`

**Component:**
```jsx
import ReactMarkdown from 'react-markdown';

// inside your map function
<div className={`message ${msg.role === 'user' ? 'user-msg' : 'ai-msg'}`}>
  <ReactMarkdown>{msg.content}</ReactMarkdown>
</div>
```

### D. Auto-Scroll to Bottom
Create a ref for the bottom of the chat list and scroll to it whenever `messages` change.

```javascript
const messagesEndRef = useRef(null);

const scrollToBottom = () => {
  messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
};

useEffect(() => {
  scrollToBottom();
}, [messages]);

// In JSX:
// <div className="messages-list">...messages... <div ref={messagesEndRef} /></div>
```

## 5. UI/UX Recommendations

1.  **Typing Indicator**: While `isLoading` is true, show a "..." bubble or a skeleton loader.
2.  **Input Disabling**: Disable the text input and send button while `isLoading` is true to prevent double sends.
3.  **Chat Button**: Recommended to have a floating action button (FAB) at the bottom right that opens the chat as a modal or drawer.
4.  **Source Badge**: If `data.source === 'database'`, you can add a small "✓ Verified" badge next to the message to show it came from the official FAQ.

## 6. Place Cards Logic (New Feature)

The API now returns a `data` array when specific places are found. You should use this to render interactive cards below the AI text response.

### Implementation Guide

1.  **Check for Data**: In your message loop, check if the current message object has a `data` array with items.
2.  **Render Carousel**: Use a horizontal scroll container (CSS: `overflow-x-auto`, `flex`) to display the cards.
3.  **Card Component**:
    *   **Thumbnail**: Display `place.images[0]`.
    *   **Title**: `place.name`
    *   **Rating**: Render stars for `place.rating`.
    *   **Action**: A "Show More" button linking to `/place/${place.id}`.

### Example Component Snippet

```jsx
import { Link } from 'react-router-dom';

// Inside your message rendering loop
{msg.data && msg.data.length > 0 && (
  <div className="flex gap-4 overflow-x-auto p-2 mt-2">
    {msg.data.map((place) => (
      <div key={place.id} className="min-w-[200px] border rounded-lg p-2 shadow-sm bg-white dark:bg-gray-800">
        <img 
          src={place.images[0]} 
          alt={place.name} 
          className="w-full h-32 object-cover rounded-md mb-2" 
        />
        <h4 className="font-bold text-sm truncate">{place.name}</h4>
        <div className="text-yellow-500 text-xs my-1">
           {'★'.repeat(Math.round(place.rating || 0))}
        </div>
        <Link 
          to={`/place/${place.id}`} 
          className="block w-full text-center bg-blue-600 text-white text-xs py-2 rounded hover:bg-blue-700 transition"
        >
          Show More
        </Link>
      </div>
    ))}
  </div>
)}
```

